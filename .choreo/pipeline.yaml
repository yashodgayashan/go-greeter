steps:
  - name: Build Steps
    containerSet:
      containers:
      - name: Buildpack Build
        containerTemplate: choreo/buildpack-build@v1
      - name: Vulnerability Scan
        containerTemplate: choreo/trivy-scan@v1
      - name: Test
        containerTemplate: test-container
      - name: Lint
        containerTemplate: lint-container

containerTemplates:
  - name: test-container
    image: golang:latest
    inlineScript: |
      #!/bin/sh
      echo "Installing Go version {{VARIABLES.GO_VERSION}} and running tests..."
      go version

      cd $REPOSITORY_DIR
      make test
    env:
      - name: GO_VERSION
        value: {{VARIABLES.GO_VERSION}}
  - name: lint-container
    inlineScript: |
      #!/bin/sh
      echo "Installing Go version {{VARIABLES.GO_VERSION}} and running tests..."
      go version
      cd $REPOSITORY_DIR
      make lint-comprehensive

    env:
      - name: GO_VERSION
        value: {{VARIABLES.GO_VERSION}}

